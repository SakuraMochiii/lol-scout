{% extends "base.html" %}
{% block title %}Dashboard — LOL IMs Info{% endblock %}
{% block content %}
<h1>Tournament Dashboard</h1>

{% if not data.teams %}
<div class="empty-state">
  <p>No teams yet. <a href="/manage">Add teams</a> to get started.</p>
</div>
{% else %}

{% if not data.meta.my_team_id %}
<div class="alert">Set your team in <a href="/manage">Manage</a> to enable analysis.</div>
{% endif %}

<div class="team-grid">
  {% for team in data.teams %}
  <div class="team-card {{ 'my-team' if data.meta.my_team_id == team.id else '' }}">
    {% if data.meta.my_team_id == team.id %}
    <div class="my-team-badge">MY TEAM</div>
    {% endif %}
    <h2><a href="/team/{{ team.id }}">{{ team.name }}</a></h2>
    <table class="dashboard-roster">
      <thead>
        <tr><th></th><th>Player</th><th>Peak</th><th>Cur</th><th>Last</th></tr>
      </thead>
      <tbody>
      {% for player in team.players %}
      {% if not player.is_substitute %}
      {% set cur_higher = player|current_higher_than_peak %}
      <tr>
        <td><span class="role-tag">{{ player.role[:3].upper() }}</span></td>
        <td class="player-name-mini">{{ player.game_name }}</td>
        <td>
          {% if player.stats and player.stats.peak_tier %}
          {% if cur_higher %}
          <span class="dashboard-plain">{{ player.stats.peak_tier }}</span>
          {% else %}
          <span class="dashboard-colored" style="color: {{ player.stats.peak_tier|peak_color }}">{{ player.stats.peak_tier }}</span>
          {% endif %}
          {% else %}—{% endif %}
        </td>
        <td>
          {% if player.stats and player.stats.tier != 'UNRANKED' %}
          {% if cur_higher %}
          <span class="dashboard-colored" style="color: {{ player.stats.tier|tier_color }}">{{ player|tier_display }}</span>
          {% else %}
          <span class="dashboard-plain">{{ player|tier_display }}</span>
          {% endif %}
          {% else %}<span class="dashboard-plain">—</span>{% endif %}
        </td>
        <td>
          {% if player.stats and player.stats.previous_season_tier %}
          <span class="dashboard-plain">{{ player.stats.previous_season_tier }}</span>
          {% else %}—{% endif %}
        </td>
      </tr>
      {% endif %}
      {% endfor %}
      </tbody>
    </table>
    {% set subs = team.players|selectattr("is_substitute")|list %}
    {% if subs %}
    <div class="subs-label">+{{ subs|length }} sub{{ 's' if subs|length > 1 else '' }}</div>
    {% endif %}
    <div class="team-actions">
      <a href="/team/{{ team.id }}" class="btn btn-sm">View</a>
      {% if data.meta.my_team_id and data.meta.my_team_id != team.id %}
      <a href="/analysis/{{ team.id }}" class="btn btn-sm btn-accent">Analyze</a>
      {% endif %}
    </div>
  </div>
  {% endfor %}
</div>
{% endif %}
{% endblock %}
